"use strict";(globalThis.webpackChunkjob=globalThis.webpackChunkjob||[]).push([[1050],{5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>u});var a=n(6540);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},h="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef(function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),h=p(n),m=o,u=h["".concat(s,".").concat(m)]||h[m]||g[m]||r;return n?a.createElement(u,i(i({ref:t},c),{},{components:n})):a.createElement(u,i({ref:t},c))});function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7823:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(8168),o=(n(6540),n(5680));const r={},i="What is an Event Loop?",l={unversionedId:"questions/nodejs/nodejs-event-loop",id:"questions/nodejs/nodejs-event-loop",title:"What is an Event Loop?",description:'In Node.js, the event loop is the mechanism that handles the execution of JavaScript code asynchronously without blocking "single" thread.',source:"@site/interview/questions/nodejs/nodejs-event-loop.md",sourceDirName:"questions/nodejs",slug:"/questions/nodejs/nodejs-event-loop",permalink:"/questions/nodejs/nodejs-event-loop",draft:!1,editUrl:"https://github.com/izemil/job/edit/master/interview/questions/nodejs/nodejs-event-loop.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How do you handle errors in a NodeJS application?",permalink:"/questions/nodejs/nodejs-error-handling"},next:{title:"What are the key features of NodeJS?",permalink:"/questions/nodejs/nodejs-features"}},s={},p=[{value:"Core Philosophy: Offloading and Reacting",id:"core-philosophy-offloading-and-reacting",level:2},{value:"The Architectural Components",id:"the-architectural-components",level:2},{value:"The Event Loop Phases (The Detailed Iteration)",id:"the-event-loop-phases-the-detailed-iteration",level:2},{value:"1. <strong>Timers Phase</strong>",id:"1-timers-phase",level:3},{value:"2. <strong>Pending Callbacks Phase</strong>",id:"2-pending-callbacks-phase",level:3},{value:"3. <strong>Idle, Prepare Phase</strong>",id:"3-idle-prepare-phase",level:3},{value:"4. <strong>Poll Phase (The Heart of I/O)</strong>",id:"4-poll-phase-the-heart-of-io",level:3},{value:"5. <strong>Check Phase</strong>",id:"5-check-phase",level:3},{value:"6. <strong>Close Callbacks Phase</strong>",id:"6-close-callbacks-phase",level:3},{value:"Microtasks: The High-Priority Interrupt",id:"microtasks-the-high-priority-interrupt",level:2},{value:"Execution Order Example",id:"execution-order-example",level:3},{value:"Senior-Level Implications &amp; Best Practices",id:"senior-level-implications--best-practices",level:2},{value:"Summary for the Interviewer",id:"summary-for-the-interviewer",level:2}],c={toc:p},h="wrapper";function g({components:e,...t}){return(0,o.yg)(h,(0,a.A)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,o.yg)("h1",{id:"what-is-an-event-loop"},"What is an Event Loop?"),(0,o.yg)("p",null,'In Node.js, the event loop is the mechanism that handles the execution of JavaScript code asynchronously without blocking "single" thread.'),(0,o.yg)("h2",{id:"core-philosophy-offloading-and-reacting"},"Core Philosophy: Offloading and Reacting"),(0,o.yg)("p",null,"Node.js is single-threaded for ",(0,o.yg)("strong",{parentName:"p"},"JavaScript execution"),", but it is decidedly ",(0,o.yg)("strong",{parentName:"p"},"not single-threaded")," in its entirety. The core idea is to avoid blocking the main JavaScript thread for I/O-bound or CPU-intensive tasks. Instead, it offloads these operations and efficiently reacts to their completion via the Event Loop."),(0,o.yg)("h2",{id:"the-architectural-components"},"The Architectural Components"),(0,o.yg)("p",null,"To understand the loop, we must first know the players:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"Call Stack:")," The single thread where your JavaScript code (V8) is executed. One frame per function call."),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"Node.js APIs (libuv):")," Provides asynchronous APIs for things like ",(0,o.yg)("inlineCode",{parentName:"li"},"fs.readFile"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"setTimeout"),", ",(0,o.yg)("inlineCode",{parentName:"li"},"http.request"),". When called from the stack, they initiate an operation and hand it off."),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"Thread Pool (libuv):")," A pool of four threads (by default, configurable via ",(0,o.yg)("inlineCode",{parentName:"li"},"UV_THREADPOOL_SIZE"),') used for handling "expensive" operations that the OS doesn\'t provide an asynchronous interface for (e.g., some file system operations, CPU-intensive crypto functions).'),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"Kernel Async Mechanisms:")," Modern OSs have their own asynchronous interfaces (e.g., ",(0,o.yg)("inlineCode",{parentName:"li"},"epoll")," on Linux, ",(0,o.yg)("inlineCode",{parentName:"li"},"kqueue")," on macOS, ",(0,o.yg)("inlineCode",{parentName:"li"},"IOCP")," on Windows). Libuv leverages these for the most efficient non-blocking I/O, especially for network operations."),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"Callback Queues (a.k.a. Message Queues or Task Queues):")," A set of FIFO queues where completed asynchronous tasks place their callbacks, waiting to be picked up by the call stack. ",(0,o.yg)("strong",{parentName:"li"},"Crucially, these are not a single queue but multiple ones with different priorities.")),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("strong",{parentName:"li"},"The Event Loop Itself:")," The perpetual loop, running on the main thread, that coordinates this entire process.")),(0,o.yg)("h2",{id:"the-event-loop-phases-the-detailed-iteration"},"The Event Loop Phases (The Detailed Iteration)"),(0,o.yg)("p",null,"The loop operates in a specific set of phases. ",(0,o.yg)("strong",{parentName:"p"},"Each phase is a FIFO queue of callbacks to execute.")," The loop will execute all callbacks in the current phase before moving to the next. This is a critical detail for managing execution priority."),(0,o.yg)("p",null,"Here are the main phases in order:"),(0,o.yg)("h3",{id:"1-timers-phase"},"1. ",(0,o.yg)("strong",{parentName:"h3"},"Timers Phase")),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Executes:")," Callbacks scheduled by ",(0,o.yg)("inlineCode",{parentName:"li"},"setTimeout()")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"setInterval()"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Mechanics:")," The loop checks if the threshold time for any timer has been reached. It executes the expired timer callbacks. ",(0,o.yg)("strong",{parentName:"li"},"Important:")," The execution time is a ",(0,o.yg)("em",{parentName:"li"},"minimum")," guarantee, not a strict time. If the call stack or other phases are busy, a timer callback can be delayed.")),(0,o.yg)("h3",{id:"2-pending-callbacks-phase"},"2. ",(0,o.yg)("strong",{parentName:"h3"},"Pending Callbacks Phase")),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Executes:")," I/O callbacks that were deferred from the previous iteration (e.g., certain OS-level TCP errors).")),(0,o.yg)("h3",{id:"3-idle-prepare-phase"},"3. ",(0,o.yg)("strong",{parentName:"h3"},"Idle, Prepare Phase")),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Internal use only.")," Used for housekeeping by libuv.")),(0,o.yg)("h3",{id:"4-poll-phase-the-heart-of-io"},"4. ",(0,o.yg)("strong",{parentName:"h3"},"Poll Phase (The Heart of I/O)")),(0,o.yg)("p",null,"This is the most crucial and complex phase."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Purpose:"),(0,o.yg)("ol",{parentName:"li"},(0,o.yg)("li",{parentName:"ol"},"Calculate how long it should block and wait for I/O."),(0,o.yg)("li",{parentName:"ol"},"Execute callbacks for completed I/O operations (e.g., incoming data on a socket, a file read finishing)."))),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Mechanics:"),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},"The loop looks at the ",(0,o.yg)("strong",{parentName:"li"},"Poll Queue"),"."),(0,o.yg)("li",{parentName:"ul"},"If the Poll Queue ",(0,o.yg)("strong",{parentName:"li"},"is not empty"),", it will synchronously execute all callbacks in it until the queue is exhausted or a system-dependent limit is hit."),(0,o.yg)("li",{parentName:"ul"},"If the Poll Queue ",(0,o.yg)("strong",{parentName:"li"},"is empty"),", it will wait here for new events. The duration of this wait is determined by two things:",(0,o.yg)("ol",{parentName:"li"},(0,o.yg)("li",{parentName:"ol"},"Whether there are any timers scheduled in the ",(0,o.yg)("strong",{parentName:"li"},"Timers Phase"),"."),(0,o.yg)("li",{parentName:"ol"},"If there are, it waits only until the earliest timer is due to execute, then moves to the next phase."),(0,o.yg)("li",{parentName:"ol"},"If there are no timers, it may wait indefinitely for a new I/O event.")))))),(0,o.yg)("h3",{id:"5-check-phase"},"5. ",(0,o.yg)("strong",{parentName:"h3"},"Check Phase")),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Executes:")," Callbacks scheduled by ",(0,o.yg)("inlineCode",{parentName:"li"},"setImmediate()"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Why it exists:")," ",(0,o.yg)("inlineCode",{parentName:"li"},"setImmediate()")," is designed to execute its callback right ",(0,o.yg)("em",{parentName:"li"},"after")," the Poll Phase completes. This is a powerful tool for controlling the order of execution relative to I/O events.")),(0,o.yg)("h3",{id:"6-close-callbacks-phase"},"6. ",(0,o.yg)("strong",{parentName:"h3"},"Close Callbacks Phase")),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Executes:")," Cleanup callbacks for closed connections (e.g., ",(0,o.yg)("inlineCode",{parentName:"li"},"socket.on('close', ...)"),").")),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"After the Close Phase, the loop checks if there's any more work to be done.")," If there are any pending ",(0,o.yg)("inlineCode",{parentName:"p"},"setImmediate")," timers, or active handles, it continues to the next iteration, starting again with the ",(0,o.yg)("strong",{parentName:"p"},"Timers Phase"),". If not, the process exits."),(0,o.yg)("h2",{id:"microtasks-the-high-priority-interrupt"},"Microtasks: The High-Priority Interrupt"),(0,o.yg)("p",null,"The phases above describe ",(0,o.yg)("strong",{parentName:"p"},"macrotasks"),". However, there's a separate, higher-priority queue system: the ",(0,o.yg)("strong",{parentName:"p"},"Microtask Queue"),". This is a concept from the V8 engine, not libuv."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Populated by:")," ",(0,o.yg)("inlineCode",{parentName:"li"},"process.nextTick()")," and ",(0,o.yg)("inlineCode",{parentName:"li"},"Promise.then()")," / ",(0,o.yg)("inlineCode",{parentName:"li"},"await")," resolutions."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Execution Timing:")," The Microtask Queue is drained ",(0,o.yg)("strong",{parentName:"li"},"in between")," each macrotask in a phase, and, most importantly, ",(0,o.yg)("strong",{parentName:"li"},"at the end of each phase of the Event Loop"),".",(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"process.nextTick()")," has an even higher priority than other microtasks.")))),(0,o.yg)("h3",{id:"execution-order-example"},"Execution Order Example"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-js"},"setImmediate(() => console.log('setImmediate')); // Macrotask (Check Phase)\nsetTimeout(() => console.log('setTimeout'), 0); // Macrotask (Timers Phase)\n\nPromise.resolve().then(() => console.log('Promise')); // Microtask\nprocess.nextTick(() => console.log('nextTick')); // Microtask (Highest Prio)\n\n// Synchronous code\nconsole.log('Sync Code');\n\n// Output Order:\n// 'Sync Code'\n// 'nextTick'\n// 'Promise'\n// 'setTimeout' OR 'setImmediate' (order can vary)\n// 'setImmediate' OR 'setTimeout'\n")),(0,o.yg)("h2",{id:"senior-level-implications--best-practices"},"Senior-Level Implications & Best Practices"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"Don't Block the Loop:")," A CPU-bound task (e.g., a long-running loop, complex JSON parsing) in your JavaScript code occupies the call stack. The Event Loop cannot proceed to the next phase, and all I/O is stalled. ",(0,o.yg)("strong",{parentName:"p"},"Solution:")," Offload heavy computation to a Worker Thread or split it up using ",(0,o.yg)("inlineCode",{parentName:"p"},"setImmediate")," to yield back to the loop.")),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},(0,o.yg)("inlineCode",{parentName:"strong"},"setImmediate")," vs ",(0,o.yg)("inlineCode",{parentName:"strong"},"setTimeout(fn, 0)"),":")),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"setImmediate")," runs in the ",(0,o.yg)("strong",{parentName:"li"},"Check Phase"),", right after the Poll Phase."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"setTimeout(fn, 0)")," runs in the ",(0,o.yg)("strong",{parentName:"li"},"Timers Phase"),"."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Rule of Thumb:")," Inside an I/O cycle (e.g., in a ",(0,o.yg)("inlineCode",{parentName:"li"},"fs.readFile")," callback), ",(0,o.yg)("inlineCode",{parentName:"li"},"setImmediate")," will always fire before a timer because the Poll Phase comes before the Check Phase, which comes before the ",(0,o.yg)("em",{parentName:"li"},"next")," Timers Phase."))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},(0,o.yg)("inlineCode",{parentName:"strong"},"process.nextTick()")," vs ",(0,o.yg)("inlineCode",{parentName:"strong"},"setImmediate()"),":")),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"process.nextTick()")," is not part of the Event Loop. It fires ",(0,o.yg)("strong",{parentName:"li"},"immediately after the current operation completes, before the Event Loop proceeds to ",(0,o.yg)("em",{parentName:"strong"},"any")," next phase.")," This can starve the Event Loop if used recursively."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"setImmediate()")," is part of the Event Loop and fires in the ",(0,o.yg)("strong",{parentName:"li"},"Check Phase"),"."))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},(0,o.yg)("strong",{parentName:"p"},"I/O Polling vs. Thread Pool:")," Understand what uses the Thread Pool vs. kernel async mechanisms. File I/O (mostly), DNS, and CPU-bound crypto use the Thread Pool. Network I/O (sockets, HTTP) uses kernel async mechanisms and does ",(0,o.yg)("em",{parentName:"p"},"not")," use the Thread Pool. This is crucial for tuning performance via ",(0,o.yg)("inlineCode",{parentName:"p"},"UV_THREADPOOL_SIZE"),"."))),(0,o.yg)("h2",{id:"summary-for-the-interviewer"},"Summary for the Interviewer"),(0,o.yg)("p",null,"\"In Node.js, the Event Loop is a sophisticated runtime model orchestrated by libuv. It's a single-threaded loop for executing JavaScript, but it achieves concurrency by offloading I/O and heavy tasks to the system kernel and a thread pool. The loop progresses through distinct phases (Timers, I/O Polling, Check, etc.), each with a dedicated queue of callbacks. Crucially, microtasks from ",(0,o.yg)("inlineCode",{parentName:"p"},"Promises")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"process.nextTick"),' are executed with the highest priority between each macrotask. The key to writing high-performance Node.js is understanding this phases-and-queues model to avoid blocking the loop and to correctly manage the order of asynchronous execution."'))}g.isMDXComponent=!0}}]);